<!DOCTYPE html>
<html>
<head>
    <title>child A</title>

    <script>
        const root = 'https://durbanow1.github.io/';
        const OTCookieNames = ['OptanonConsent', 'eupubconsent-v2', 'OptanonAlertBoxClosed'];

        function loadIframe() {
            const iframe = document.createElement('iframe');
            iframe.setAttribute('src', root);
            iframe.style.display = 'none';
            document.body.appendChild(iframe);
        }

        function getCookies() {
            document.querySelector('iframe').contentWindow.postMessage({ command: 'getCookies' }, '*');
        }

        function setCookie(name, value) {
            document.querySelector('iframe').contentWindow.postMessage({ command: 'setCookie', name, value }, '*');
        }

        function checkOTCookies() {
            return document.cookie.split(';').some(cookie => OTCookieNames.some(name => cookie.startsWith(name)));
        }

        function clearOTCookies() {
            console.log('clear');
            OTCookieNames.forEach(name => document.cookie = `${name}=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;`);
            const script = document.querySelector('[data-domain-script]');
            document.head.removeChild(script);
        }

        function requestStorageAccess() {
            navigator.permissions.query({ name: 'top-level-storage-access', requestedOrigin: root }).then(res => {
                if (res.state === 'granted') {
                    document.requestStorageAccessFor(root);
                } else if (res.state === 'prompt') {
                    console.log('no access');
                    if (checkOTCookies) {
                        window.addEventListener('click', handleClick);
                        const script = document.createElement('script');
                        script.src = 'https://cdn.cookielaw.org/scripttemplates/otSDKStub.js'
                        script.setAttribute('data-document-language', 'true');
                        script.setAttribute('data-domain-script', '1310db55-16a0-4029-aee5-9253581c6a12-test');
                        console.log('append script');
                        document.head.appendChild(script);
                    }
                }
            });
        }

        function handleClick(event) {
            if (event.target.id === 'onetrust-accept-btn-handler') {
               document.requestStorageAccessFor(root); 
               window.removeEventListener('click', handleClick);
            }
        }

        window.addEventListener('message', (event) => {
            console.log('Received shared cookies:', event.data);
        });

        window.addEventListener('mouseup', (event) => {
            console.log(event, 'mouseup');
            // document.requestStorageAccessFor(root);
        });

        window.addEventListener('click', (event) => {
            console.log(event, 'click');
        });

        window.onload = () => {
            loadIframe();
            setTimeout(() => requestStorageAccess(), 0);
        }
    </script>
    <!-- OneTrust Cookies Consent Notice start for tvn24.pl -->
<script src="https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" data-document-language="true" type="text/javascript" charset="UTF-8" data-domain-script="1310db55-16a0-4029-aee5-9253581c6a12-test" ></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>
<!-- OneTrust Cookies Consent Notice end for tvn24.pl -->
</head>
</html>
